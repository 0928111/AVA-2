<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æ ‘çš„åˆ›å»ºä¸éå† Â· å¯è§†åŒ–æ¼”ç¤º</title>
  <style>
    :root {
      --primary: #1d4ed8;
      --bg: #f4f7ff;
      --card: #ffffff;
      --border: #dbe7ff;
      --muted: #64748b;
      --text: #0f172a;
      --shadow: 0 12px 36px rgba(59, 130, 246, 0.14);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Inter", "Segoe UI", "PingFang SC", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 18px;
      gap: 12px;
    }
    header {
      height: 56px;
      padding: 0 18px;
      display: flex;
      align-items: center;
      background: linear-gradient(90deg, rgba(37,99,235,0.12), rgba(59,130,246,0.08));
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      font-weight: 700;
    }
    main {
      flex: 1;
      display: grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap: 14px;
      min-height: 0;
    }
    .panel {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-shadow: var(--shadow);
      min-height: 0;
    }
    .section {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: linear-gradient(180deg, #f8fbff, #eef3ff);
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: var(--muted);
    }
    .section-title {
      font-weight: 700;
      color: var(--text);
      font-size: 15px;
    }
    .layout-grid {
      display: grid;
      grid-template-columns: 220px 1fr;
      gap: 10px;
      min-height: 0;
    }
    .site-nav {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #f6f9ff;
      padding: 10px 8px;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow: auto;
    }
    .nav-group-main {
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
      font-weight: 600;
      color: #1e293b;
      user-select: none;
    }
    .nav-group-main:hover {
      border-color: var(--border);
      background: rgba(59, 130, 246, 0.08);
    }
    .nav-group-main.active {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.24);
    }
    .site-page {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #ffffff;
      padding: 12px;
      overflow: auto;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.06);
    }
    .site-page h3 { font-size: 16px; margin-bottom: 6px; }
    .site-page p { font-size: 13px; color: var(--muted); line-height: 1.5; }
    .page-hint { font-size: 12px; color: var(--primary); border-top: 1px dashed var(--border); padding-top: 6px; margin-top: 8px; }
    .sub-links {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
    }
    .sub-links a {
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #f6f9ff;
      color: #1e293b;
      text-decoration: none;
    }
    .graph-placeholder {
      border: 1px dashed var(--border);
      background: #f7fbff;
      border-radius: 12px;
      min-height: 260px;
      display: grid;
      place-items: center;
      color: var(--muted);
      font-size: 13px;
      text-align: center;
    }
    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 12px;
    }
    .chip {
      padding: 5px 10px;
      border-radius: 999px;
      background: #e2ebff;
      color: #1f2a44;
      font-weight: 600;
      border: 1px solid var(--border);
    }
    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #f5f7ff;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn-sm.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
      box-shadow: 0 8px 18px rgba(59, 130, 246, 0.2);
    }
    .right-panel {
      position: relative;
      display: flex;
      flex-direction: column;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
      overflow: hidden;
      min-height: 0;
    }
    .code-wrap {
      background: #f6f9ff;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 160px;
      max-height: 65vh;
      overflow: auto;
    }
    .code-editor {
      width: 100%;
      border-radius: 10px;
      background: #0b1020;
      color: #e9f0ff;
      padding: 12px;
      font-family: "JetBrains Mono", "Fira Code", monospace;
      font-size: 12px;
      border: 1px solid #151931;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      min-height: 260px;
      resize: vertical;
      white-space: pre;
      outline: none;
    }
    .code-status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: var(--muted);
    }
    .btn-primary {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      background: var(--primary);
      color: #fff;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.3);
    }
    .btn-primary:disabled { background: #b7cdfa; box-shadow: none; cursor: default; }
    .splitter {
      height: 12px;
      cursor: ns-resize;
      background: linear-gradient(90deg, rgba(37,99,235,0.12), rgba(59,130,246,0.12));
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
    }
    .agent-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #ffffff;
      padding: 12px;
      min-height: 140px;
    }
    .agent-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }
    .agent-messages {
      flex: 1;
      padding: 10px 0 12px;
      overflow-y: auto;
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .msg {
      max-width: 90%;
      padding: 8px 10px;
      border-radius: 10px;
      line-height: 1.4;
    }
    .msg.user {
      align-self: flex-end;
      background: #1d4ed8;
      color: #fff;
      border-bottom-right-radius: 3px;
    }
    .msg.agent {
      align-self: flex-start;
      background: #ffffff;
      border: 1px solid var(--border);
      border-bottom-left-radius: 3px;
      box-shadow: 0 6px 18px rgba(59, 130, 246, 0.08);
    }
    .agent-input {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .agent-input textarea {
      width: 100%;
      resize: none;
      min-height: 54px;
      max-height: 120px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 13px;
      font-family: inherit;
      background: #f8fbff;
    }
    .agent-input-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--muted);
    }
    .btn-send {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      border: none;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.25);
    }
    .btn-send:disabled { background: #a1b5f4; cursor: default; box-shadow: none; }
  </style>
</head>
<body>
<header>æ ‘çš„åˆ›å»ºä¸éå† Â· å¯è§†åŒ–æ¼”ç¤º</header>

<main>
  <!-- å·¦ä¾§ï¼šç½‘ç«™é¢„è§ˆ + æ ‘å¯è§†åŒ– -->
  <section class="panel">
    <div class="section">
      <div class="section-header">
        <div class="section-title">ç½‘ç«™é¢„è§ˆ</div>
        <div id="previewSub" class="section-sub">å½“å‰è·¯å¾„ï¼šé¦–é¡µ</div>
      </div>
      <div class="layout-grid">
        <nav class="site-nav">
          <div class="nav-group" data-node="home">
            <div class="nav-group-main active" data-node="home">é¦–é¡µ</div>
          </div>
          <div class="nav-group" data-node="calligraphy">
            <div class="nav-group-main" data-node="calligraphy">ä¹¦æ³•</div>
          </div>
          <div class="nav-group" data-node="opera">
            <div class="nav-group-main" data-node="opera">äº¬å‰§</div>
          </div>
          <div class="nav-group" data-node="tea">
            <div class="nav-group-main" data-node="tea">èŒ¶æ–‡åŒ–</div>
          </div>
        </nav>
        <section class="site-page">
          <h3 id="pageTitle">ä¸­åæ–‡åŒ–ä¼ æ’­ç½‘ç«™ - é¦–é¡µ</h3>
          <p id="pageDesc">
            è¿™é‡Œæ˜¯é¦–é¡µã€‚å·¦ä¾§å¯¼èˆªå±•ç¤ºä¸€çº§æ ç›®ã€‚ç‚¹å‡»ä¸åŒæ ç›®ï¼Œå¯ä»¥è§‚å¯Ÿè·¯å¾„å’Œæ ‘çš„å¯¹åº”å…³ç³»ã€‚
          </p>
          <div id="subLinks" class="sub-links"></div>
          <p id="pageHint" class="page-hint">
            æç¤ºï¼šæ ‘çš„åˆ›å»ºä¸éå†ä¼šå¤ç”¨ PageRank çš„å¯è§†åŒ–æ¸²æŸ“ï¼Œé…åˆ BFS / DFS åŠ¨ç”»ã€‚
          </p>
        </section>
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">æ ‘å¯è§†åŒ–ï¼ˆå¤ç”¨ PageRankGraphï¼‰</div>
        <div class="section-sub">ç»„ä»¶ï¼šapp/visual/pagerank-graph.tsx æŒ‚è½½åˆ° #graphMount</div>
      </div>
      <div id="graphMount" class="graph-placeholder">
        <!-- TODO: æŒ‚è½½ PageRankGraphï¼Œæ ‘å½¢æ•°æ®æ¥è‡ªå­¦ç”Ÿä»£ç è§£æ -->
        PageRankGraph æŒ‚è½½å ä½åŒºï¼ˆåŒç°æœ‰é¡¹ç›®çš„è°ƒè‰²æ¿ä¸é˜´å½±ï¼‰
      </div>
      <div class="controls">
        <span class="chip">éå†æ¨¡å¼</span>
        <button class="btn-sm active" data-mode="bfs">BFS</button>
        <button class="btn-sm" data-mode="dfs">DFS</button>
        <button class="btn-sm" data-step="prev">ä¸Šä¸€æ­¥</button>
        <button class="btn-sm" data-step="next">ä¸‹ä¸€æ­¥</button>
        <button class="btn-sm" data-step="reset">é‡ç½®</button>
      </div>
    </div>
  </section>

  <!-- å³ä¾§ï¼šä»£ç  + Agentï¼Œä¸­é—´åˆ†éš”æ¡å¯æ‹–æ‹½ -->
  <section class="right-panel">
    <div class="code-wrap" id="codeWrap">
      <div class="section-header" style="padding:0;">
        <div class="section-title">ä»£ç åŒºï¼ˆå­¦ç”Ÿè‡ªç”±ç¼–è¾‘ &lt;a&gt;ï¼‰</div>
        <div class="section-sub">åƒ txt ä¸€æ ·éšæ„å†™ï¼Œè‡ªåŠ¨è§£æé“¾æ¥</div>
      </div>
      <textarea class="code-editor" id="codeEditor" spellcheck="false">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ä¸­åæ–‡åŒ–ä¼ æ’­ç½‘ç«™ - é¦–é¡µ</title>
</head>
<body>
  <h1>ä¸­åæ–‡åŒ–ä¼ æ’­ç½‘ç«™</h1>
  <p>è¯·é€‰æ‹©ä½ æƒ³äº†è§£çš„ä¼ ç»Ÿæ–‡åŒ–ä¸»é¢˜ï¼š</p>
  <a href="calligraphy.html">ä¹¦æ³•</a>
  <a href="opera.html">äº¬å‰§</a>
  <a href="tea.html">èŒ¶æ–‡åŒ–</a>
  <!-- äºŒçº§é¡µä¸‹çš„ç¤ºä¾‹ä¸‰çº§é“¾æ¥ -->
  <a href="calligraphy-intro.html">ä¹¦æ³•ç®€ä»‹</a>
  <a href="opera-intro.html">äº¬å‰§ç®€ä»‹</a>
  <a href="tea-intro.html">èŒ¶å¶æ•…äº‹</a>
</body>
</html>
      </textarea>
      <div class="code-status-row">
        <div class="code-status-text" id="codeStatus">å·²è§£æé“¾æ¥ï¼š0</div>
        <button class="btn-primary" id="submitBtn">æäº¤ä»£ç </button>
      </div>
    </div>

    <div class="splitter" id="splitter" title="æ‹–åŠ¨ä»¥è°ƒæ•´ä»£ç  / åŠ©æ‰‹åŒºé«˜åº¦"></div>

    <div class="agent-area" id="agentArea">
      <div class="agent-head">
        <span>å­¦ä¹ åŠ©æ‰‹</span>
        <span class="section-sub">ä¿æŒä¸ä¸»ç«™è§†è§‰ä¸€è‡´</span>
      </div>
      <div class="agent-messages" id="agentMessages">
        <div class="msg agent">
          ğŸ‘‹ æç¤ºï¼šç›´æ¥ç¼–è¾‘å³ä¾§ä»£ç ï¼Œæäº¤åå·¦ä¾§å¯¼èˆª / æ ‘å°†åŒæ­¥ï¼ŒBFS / DFS å¯æ­¥è¿›æŸ¥çœ‹éå†ã€‚
        </div>
      </div>
      <div class="agent-input">
        <textarea id="agentInput" placeholder="ä¾‹å¦‚ï¼šDFS ä¸ºä»€ä¹ˆæ›´æ—©è®¿é—®åˆ°â€œä¹¦æ³•ç®€ä»‹â€ï¼Ÿ"></textarea>
        <div class="agent-input-row">
          <span>å›è½¦å‘é€ï¼ˆShift+Enter æ¢è¡Œï¼‰</span>
          <button class="btn-send" id="sendBtn" disabled>å‘é€</button>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
  // ====== åŸºç¡€å¼•ç”¨ ======
  const codeEditor = document.getElementById('codeEditor');
  const codeStatus = document.getElementById('codeStatus');
  const submitBtn = document.getElementById('submitBtn');
  const graphMount = document.getElementById('graphMount');

  const navMainItems = document.querySelectorAll('.nav-group-main');
  const previewSubEl = document.getElementById('previewSub');
  const pageTitle = document.getElementById('pageTitle');
  const pageDesc = document.getElementById('pageDesc');
  const subLinks = document.getElementById('subLinks');

  const parentMap = {
    'calligraphy-intro': 'calligraphy',
    'opera-intro': 'opera',
    'tea-intro': 'tea'
  };

  const nodeMeta = {
    home: { href: 'index.html', label: 'é¦–é¡µ' },
    calligraphy: { href: 'calligraphy.html', label: 'ä¹¦æ³•' },
    opera: { href: 'opera.html', label: 'äº¬å‰§' },
    tea: { href: 'tea.html', label: 'èŒ¶æ–‡åŒ–' },
    'calligraphy-intro': { href: 'calligraphy-intro.html', label: 'ä¹¦æ³•ç®€ä»‹' },
    'opera-intro': { href: 'opera-intro.html', label: 'äº¬å‰§ç®€ä»‹' },
    'tea-intro': { href: 'tea-intro.html', label: 'èŒ¶å¶æ•…äº‹' }
  };

  function buildChildMap(meta) {
    const childMap = { home: ['calligraphy', 'opera', 'tea'] };
    Object.keys(meta).forEach((id) => {
      if (parentMap[id]) {
        const p = parentMap[id];
        childMap[p] = childMap[p] || [];
        if (!childMap[p].includes(id)) childMap[p].push(id);
      }
    });
    return childMap;
  }

  function renderSubLinks(nodeId) {
    if (!subLinks) return;
    subLinks.innerHTML = '';
    const childMap = buildChildMap(nodeMeta);
    const children = childMap[nodeId] || [];
    children.forEach((cid) => {
      const meta = nodeMeta[cid] || {};
      const a = document.createElement('a');
      a.href = meta.href || '#';
      a.textContent = meta.label || cid;
      subLinks.appendChild(a);
    });
    if (!children.length) {
      const meta = nodeMeta[nodeId] || {};
      const a = document.createElement('a');
      a.href = meta.href || '#';
      a.textContent = meta.label || nodeId;
      subLinks.appendChild(a);
    }
  }

  function getTextByNode(nodeId) {
    switch (nodeId) {
      case 'home': return { path: 'é¦–é¡µ', title: 'ä¸­åæ–‡åŒ–ä¼ æ’­ç½‘ç«™ - é¦–é¡µ', desc: 'é¦–é¡µã€‚å·¦ä¾§å¯¼èˆªè¿›å…¥ä¹¦æ³•ã€äº¬å‰§å’ŒèŒ¶æ–‡åŒ–ç­‰é¡µé¢ã€‚' };
      case 'calligraphy': return { path: 'é¦–é¡µ / ä¹¦æ³•', title: 'ä¹¦æ³• - æ ç›®é¡µ', desc: 'ä¹¦æ³•æ ç›®é¡µï¼Œä¸‹æœ‰â€œä¹¦æ³•ç®€ä»‹â€ç­‰å­èŠ‚ç‚¹ã€‚' };
      case 'opera': return { path: 'é¦–é¡µ / äº¬å‰§', title: 'äº¬å‰§ - æ ç›®é¡µ', desc: 'äº¬å‰§æ ç›®é¡µï¼Œä¸‹æœ‰â€œäº¬å‰§ç®€ä»‹â€ç­‰å­èŠ‚ç‚¹ã€‚' };
      case 'tea': return { path: 'é¦–é¡µ / èŒ¶æ–‡åŒ–', title: 'èŒ¶æ–‡åŒ– - æ ç›®é¡µ', desc: 'èŒ¶æ–‡åŒ–æ ç›®é¡µï¼Œä¸‹æœ‰â€œèŒ¶å¶æ•…äº‹â€ç­‰å­èŠ‚ç‚¹ã€‚' };
      case 'calligraphy-intro': return { path: 'é¦–é¡µ / ä¹¦æ³• / ä¹¦æ³•ç®€ä»‹', title: 'ä¹¦æ³•ç®€ä»‹', desc: 'ç¤ºä¾‹å­é¡µé¢ï¼šæ ‘çš„ç¬¬ä¸‰å±‚æ¼”ç¤ºã€‚' };
      case 'opera-intro': return { path: 'é¦–é¡µ / äº¬å‰§ / äº¬å‰§ç®€ä»‹', title: 'äº¬å‰§ç®€ä»‹', desc: 'ç¤ºä¾‹å­é¡µé¢ï¼šæ ‘çš„ç¬¬ä¸‰å±‚æ¼”ç¤ºã€‚' };
      case 'tea-intro': return { path: 'é¦–é¡µ / èŒ¶æ–‡åŒ– / èŒ¶å¶æ•…äº‹', title: 'èŒ¶å¶æ•…äº‹', desc: 'ç¤ºä¾‹å­é¡µé¢ï¼šæ ‘çš„ç¬¬ä¸‰å±‚æ¼”ç¤ºã€‚' };
      default: return { path: 'æœªçŸ¥è·¯å¾„', title: 'æœªå®šä¹‰é¡µé¢', desc: 'å ä½èŠ‚ç‚¹ï¼Œå¯æ‰©å±•ã€‚' };
    }
  }

  function updatePageByNode(nodeId) {
    const info = getTextByNode(nodeId);
    previewSubEl.textContent = 'å½“å‰è·¯å¾„ï¼š' + info.path;
    pageTitle.textContent = info.title;
    pageDesc.textContent = info.desc;
    navMainItems.forEach((m) => m.classList.remove('active'));
    const main = document.querySelector('.nav-group-main[data-node="' + nodeId + '"]');
    if (main) main.classList.add('active');
    renderSubLinks(nodeId);
  }

  navMainItems.forEach((main) => {
    main.addEventListener('click', () => {
      const nodeId = main.dataset.node;
      updatePageByNode(nodeId);
      // TODO: åŒæ­¥é«˜äº®åˆ° PageRankGraph
    });
  });

  // ====== è§£æä»£ç åŒºä¸­çš„ <a href>ï¼Œé©±åŠ¨å¯¼èˆª/æ ‘ ======
  function parseLinksAndApply(isSubmit = false) {
    const linkRegex = /<a\s+href\s*=\s*"([^"]+)"\s*>([^<]+)<\/a>/gi;
    const raw = codeEditor ? codeEditor.innerText || '' : '';
    let parsedCount = 0;
    let match;
    while ((match = linkRegex.exec(raw)) !== null) {
      const href = match[1];
      const label = match[2];
      const normalized = href.toLowerCase();
      let slot = '';
      if (normalized.includes('calligraphy-intro')) slot = 'calligraphy-intro';
      else if (normalized.includes('opera-intro')) slot = 'opera-intro';
      else if (normalized.includes('tea-intro')) slot = 'tea-intro';
      else if (normalized.includes('calligraphy')) slot = 'calligraphy';
      else if (normalized.includes('opera')) slot = 'opera';
      else if (normalized.includes('tea')) slot = 'tea';
      if (slot) {
        nodeMeta[slot] = { href, label };
        parsedCount++;
      }
    }
    if (codeStatus) codeStatus.textContent = 'å·²è§£æé“¾æ¥ï¼š' + parsedCount;

    // æ›´æ–°å·¦ä¾§å¯¼èˆªã€æ ‘èŠ‚ç‚¹æ–‡æœ¬
    Object.keys(nodeMeta).forEach((id) => {
      const meta = nodeMeta[id];
      const target = document.querySelector('.nav-group-main[data-node="' + id + '"]');
      if (target) target.textContent = meta.label;
      const treeNode = document.querySelector('.tree-node[data-node="' + id + '"]');
      if (treeNode) treeNode.textContent = meta.label;
    });

    // æ›´æ–°ä¸‰çº§é“¾æ¥åŒºåŸŸ
    const activeMain = document.querySelector('.nav-group-main.active');
    const activeId = activeMain ? activeMain.dataset.node : 'home';
    renderSubLinks(activeId);

    if (isSubmit) {
      // TODO: å°† nodeMeta è½¬ä¸ºæ ‘å½¢èŠ‚ç‚¹/è¾¹æ•°æ®ï¼Œdispatch åˆ° PageRankGraphï¼ˆä¿æŒæ— ç¯ï¼‰
      graphMount.textContent = 'å·²æäº¤åˆæ³•è¶…é“¾æ¥ï¼Œæ ‘æ•°æ®å°†å–‚ç»™ PageRankGraph æ¸²æŸ“ã€‚';
    }
  }

  // åˆå§‹è§£æ
  updatePageByNode('home');
  parseLinksAndApply(false);
  submitBtn.addEventListener('click', () => parseLinksAndApply(true));

  // ====== éå†æ¨¡å¼æ­¥è¿› ======
  const modeButtons = document.querySelectorAll('.btn-sm[data-mode]');
  const stepButtons = document.querySelectorAll('.btn-sm[data-step]');
  let mode = 'bfs';
  let stepIndex = 0;
  const bfsOrder = ['home', 'calligraphy', 'opera', 'tea', 'calligraphy-intro', 'opera-intro', 'tea-intro'];
  const dfsOrder = ['home', 'calligraphy', 'calligraphy-intro', 'opera', 'opera-intro', 'tea', 'tea-intro'];

  modeButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      modeButtons.forEach((b) => b.classList.remove('active'));
      btn.classList.add('active');
      mode = btn.dataset.mode;
      stepIndex = 0;
      updatePageByNode('home');
      // TODO: å°†æ¨¡å¼ä¼ ç»™ PageRankGraph æˆ–éå†æ§åˆ¶é€»è¾‘
    });
  });

  stepButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const action = btn.dataset.step;
      const order = mode === 'bfs' ? bfsOrder : dfsOrder;
      if (action === 'next') {
        if (stepIndex < order.length) {
          updatePageByNode(order[stepIndex]);
          stepIndex++;
        }
      } else if (action === 'prev') {
        stepIndex = Math.max(1, stepIndex - 1);
        updatePageByNode(order[stepIndex - 1]);
      } else if (action === 'reset') {
        stepIndex = 0;
        updatePageByNode('home');
      }
      // TODO: åŒæ­¥æ­¥éª¤åˆ° PageRankGraph é«˜äº®
    });
  });

  // ====== Agent è¾“å…¥ ======
  const agentInput = document.getElementById('agentInput');
  const sendBtn = document.getElementById('sendBtn');
  const agentMessages = document.getElementById('agentMessages');

  agentInput.addEventListener('input', () => {
    const val = agentInput.value.trim();
    sendBtn.disabled = val.length === 0;
  });

  agentInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      if (!sendBtn.disabled) sendMessage();
    }
  });

  sendBtn.addEventListener('click', sendMessage);

  function sendMessage() {
    const text = agentInput.value.trim();
    if (!text) return;
    const userMsg = document.createElement('div');
    userMsg.className = 'msg user';
    userMsg.textContent = text;
    agentMessages.appendChild(userMsg);
    const reply = document.createElement('div');
    reply.className = 'msg agent';
    reply.textContent = 'ã€Demoã€‘å¯ä»¥åˆ‡æ¢ BFS / DFSï¼Œçœ‹èŠ‚ç‚¹é«˜äº®é¡ºåºå¦‚ä½•å˜åŒ–ã€‚';
    agentMessages.appendChild(reply);
    agentMessages.scrollTop = agentMessages.scrollHeight;
    agentInput.value = '';
    sendBtn.disabled = true;
  }

  // ====== ä»£ç åŒºä¸åŠ©æ‰‹åŒºä¹‹é—´çš„å¯æ‹–æ‹½åˆ†éš” ======
  const splitter = document.getElementById('splitter');
  const codeWrap = document.getElementById('codeWrap');
  const agentArea = document.getElementById('agentArea');
  let isDragging = false;
  let startY = 0;
  let startHeight = 0;

  splitter.addEventListener('mousedown', (e) => {
    isDragging = true;
    startY = e.clientY;
    startHeight = codeWrap.getBoundingClientRect().height;
    document.body.style.userSelect = 'none';
  });

  window.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    const delta = e.clientY - startY;
    const newHeight = Math.max(140, startHeight + delta);
    codeWrap.style.flex = '0 0 ' + newHeight + 'px';
    agentArea.style.flex = '1 1 auto';
  });

  window.addEventListener('mouseup', () => {
    isDragging = false;
    document.body.style.userSelect = '';
  });
</script>
</body>
</html>

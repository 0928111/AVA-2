# 树的创建与遍历页面接入计划（最终版）

## 1. 项目结构与路由设计

### 1.1 保留原有首页
- 保留 `app/components/home.tsx` 及其相关文件
- 确保原有PageRank功能不受影响
- 原有首页可通过路由访问（如 `/pagerank`）

### 1.2 创建新页面组件
- 创建 `app/components/tree-visualization.tsx` 作为树可视化主组件
- 创建 `app/components/tree-visualization.module.scss` 用于样式管理
- 创建 `app/utils/tree-parser.ts` 用于链接解析和树数据生成

### 1.3 修改路由配置
- 修改 `app/page.tsx`，将默认页面设置为新的树可视化组件
- 考虑添加路由切换机制，方便在新页面和原首页之间切换

## 2. 组件实现细节

### 2.1 主组件结构
```typescript
// tree-visualization.tsx
import React, { useState, useRef, useEffect } from 'react';
import dynamic from 'next/dynamic';
import styles from './tree-visualization.module.scss';
import { parseLinks } from '../utils/tree-parser';

// 动态导入PageRankGraph组件
const PageRankGraph = dynamic(() => import('../visual/pagerank-graph'), {
  ssr: false,
  loading: () => <div>Loading tree visualization...</div>
});

export default function TreeVisualization() {
  // 状态管理
  const [code, setCode] = useState('');
  const [treeData, setTreeData] = useState(null);
  const [currentNode, setCurrentNode] = useState('home');
  const [traversalMode, setTraversalMode] = useState('bfs');
  const [stepIndex, setStepIndex] = useState(0);
  
  // 引用
  const graphMountRef = useRef(null);
  
  // 功能实现
  const handleCodeChange = (e) => {
    setCode(e.target.value);
    // 实时解析链接
  };
  
  const handleSubmit = () => {
    // 解析链接并生成树数据
    const parsedData = parseLinks(code);
    setTreeData(parsedData);
  };
  
  // BFS/DFS遍历逻辑
  const handleTraversalStep = (direction) => {
    // 实现遍历步进逻辑
  };
  
  return (
    <div className={styles.container}>
      {/* 页面布局 */}
    </div>
  );
}
```

### 2.2 链接解析工具
```typescript
// tree-parser.ts
export function parseLinks(code: string) {
  // 正则表达式匹配<a href>标签
  const linkRegex = /<a\s+href\s*=\s*"([^"\s]+)"\s*>([^<]+)<\/a>/gi;
  let match;
  const links = [];
  
  while ((match = linkRegex.exec(code)) !== null) {
    links.push({
      href: match[1],
      label: match[2]
    });
  }
  
  // 生成树形结构
  return generateTreeData(links);
}

function generateTreeData(links: Array<{href: string, label: string}>) {
  // 实现树形数据生成逻辑
  // 确保无环、层级正确
}
```

## 3. 样式与布局

### 3.1 样式迁移
- 将临时HTML中的内联样式转换为SCSS模块化样式
- 保持现有项目的配色方案和阴影效果
- 使用CSS变量统一管理颜色和尺寸

### 3.2 布局结构
```html
<div class="container">
  <header>树的创建与遍历 · 可视化演示</header>
  <main>
    <!-- 左侧面板 -->
    <section class="left-panel">
      <!-- 网站预览 -->
      <div class="site-preview">
        <nav class="site-nav"></nav>
        <section class="site-page"></section>
      </div>
      <!-- 树可视化 -->
      <div class="tree-visualization">
        <div ref={graphMountRef} class="graph-container"></div>
        <div class="controls">
          <!-- BFS/DFS控制按钮 -->
        </div>
      </div>
    </section>
    <!-- 右侧面板 -->
    <section class="right-panel">
      <!-- 代码编辑区 -->
      <div class="code-editor"></div>
      <!-- 分隔条 -->
      <div class="splitter"></div>
      <!-- AI助手 -->
      <div class="agent-area"></div>
    </section>
  </main>
</div>
```

## 4. 核心功能实现

### 4.1 树数据生成
- 解析textarea中的`<a href>`标签
- 提取链接和标签文本
- 根据URL路径生成树形结构
- 确保树结构无环、层级正确

### 4.2 BFS/DFS遍历
- 实现BFS算法：按层级遍历节点
- 实现DFS算法：深度优先遍历节点
- 支持步进控制（上一步/下一步/重置）
- 遍历过程中高亮当前节点和路径

### 4.3 图可视化集成
- 将生成的树数据转换为PageRankGraph所需的GraphData格式
- 初始化图组件并传入数据
- 实现节点高亮和路径动画
- 支持数据更新和重新渲染

## 5. 交互与同步

### 5.1 导航交互
- 左侧导航点击时，同步更新当前节点
- 高亮当前节点在树可视化中的位置
- 更新页面内容和路径显示

### 5.2 遍历同步
- BFS/DFS步进时，更新当前节点
- 同步高亮导航和树可视化中的节点
- 显示当前遍历步骤和进度

### 5.3 代码提交同步
- 提交代码后，重新解析链接并生成树数据
- 刷新图可视化组件
- 重置遍历状态

## 6. 清理与优化

### 6.1 文案清理
- 删除demo/提示性文字
- 保留必要的功能说明
- 确保页面简洁清晰

### 6.2 性能优化
- 实现防抖解析，避免频繁更新
- 优化图数据转换逻辑
- 确保动画流畅，无性能问题

### 6.3 代码规范
- 遵循现有项目的代码规范
- 保持代码清晰可维护
- 添加必要的类型定义

## 7. 实现步骤

1. 创建新的组件文件和样式文件
2. 实现基本布局结构
3. 实现链接解析功能
4. 实现树形数据生成
5. 集成PageRankGraph组件
6. 实现BFS/DFS遍历逻辑
7. 实现交互同步功能
8. 优化样式和用户体验
9. 修改路由配置，将新页面作为默认页面
10. 测试和调试

## 8. 技术栈与依赖

- React 18
- Next.js 14
- TypeScript
- SCSS
- D3.js（通过PageRankGraph组件）
- 现有项目的样式体系和组件

## 9. 预期效果

- 默认页面显示新的树的创建与遍历页面
- 支持从代码区解析链接，动态生成树形结构
- 支持BFS/DFS两种遍历模式，可步进查看
- 左侧导航与树可视化同步高亮
- 保持与现有项目一致的视觉风格
- 原有首页功能保留，可通过适当方式访问

## 10. 风险与应对

- 链接解析复杂度过高：使用正则表达式优化，限制解析范围
- 图数据转换错误：添加数据验证和错误处理
- 动画性能问题：优化算法复杂度，实现按需渲染
- 样式冲突：使用SCSS模块化，避免全局样式污染

## 11. 后续扩展建议

- 添加树结构导出功能
- 支持自定义节点样式
- 实现更多遍历算法
- 添加节点详情查看功能
- 支持树结构的手动编辑

该计划确保了原有首页的保留，同时将新的树可视化页面作为默认页面，实现了所有要求的功能，并考虑了性能优化和代码规范。